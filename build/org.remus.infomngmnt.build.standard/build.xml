<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     06.10.2008 21:18:48                                                        

     project    
     description
                   
     tmseidel                                                                
     ====================================================================== -->


<project name="project" default="build">
	
	<property name="build.dir.location" location="/opt/bamboo/bamboohome/xml-data/build-dir/RCP-TRUNK/build/org.remus.infomngmnt.build/N.RIM"/>
	<property name="unzipTarget" location="/opt/bamboo/bamboohome/xml-data/build-dir/RCP-STANDARD/standard"/>
	<property name="p2.marketplace.input.repo" value="/var/www/vhosts/remus-software.org/httpdocs/updatesites/remus" />
	<property name="deployDir" location="${unzipTarget}/RIM"/>
	<property name="jar.test.location" location="${deployDir}/plugins/org.eclipse.equinox.launcher_1.1.0.v20100507.jar"/>
	<property name="p2.director.install.path" value="${deployDir}" />
	<property name="p2.director.destination" value="${deployDir}" />

	<!-- ================================= 
          target: pack              
         ================================= -->
	<target name="clean">
		<delete dir="${unzipTarget}"></delete>
	</target>
	
	<!-- ================================= 
          target: build              
         ================================= -->
    <target name="build" description="description">
        <antcall target="pack">
        	<param name="pack.zip" value="RIM-linux.gtk.x86.zip"/>
        </antcall>
        <antcall target="pack">
        	<param name="pack.zip" value="RIM-win32.win32.x86.zip"/>
        </antcall>
        <antcall target="pack">
        	<param name="pack.zip" value="RIM-win32.win32.x86_64.zip"/>
        </antcall>
        <antcall target="pack">
        	<param name="pack.zip" value="RIM-linux.gtk.x86_64.zip"/>
        </antcall>
        <antcall target="pack">
        	<param name="pack.zip" value="RIM-macosx.carbon.ppc.zip"/>
        </antcall>
        <antcall target="pack">
        	<param name="pack.zip" value="RIM-macosx.cocoa.x86.zip"/>
        </antcall>
    </target>

	
    <target name="pack" description="description" depends="clean">
    	<unzip dest="${unzipTarget}" src="${build.dir.location}/${pack.zip}"></unzip>
    	<antcall target="installFeatureFromMarketplace">
    		<param name="marketplace.installUI" value="org.remus.infomngmnt.mindmap.feature" />
    	</antcall>
    	<antcall target="installFeatureFromMarketplace">
    				<param name="marketplace.installUI" value="org.remus.infomgnmgnt.google.feature" />
    			</antcall>
    	<antcall target="installFeatureFromMarketplace">
    				<param name="marketplace.installUI" value="org.remus.infomngmnt.calendar.feature" />
    			</antcall>
    	<antcall target="installFeatureFromMarketplace">
    				<param name="marketplace.installUI" value="org.remus.infomgnmnt.multimedia.feature" />
    			</antcall>
    			<antcall target="installFeatureFromMarketplace">
    				<param name="marketplace.installUI" value="org.remus.infomngmnt.textediting.feature" />
    			</antcall>
    			<antcall target="installFeatureFromMarketplace">
    				<param name="marketplace.installUI" value="org.remus.infomngmnt.filebased.feature" />
    			</antcall>
    	<antcall target="installFeatureFromMarketplace">
    				<param name="marketplace.installUI" value="org.remus.infomngmnt.pdf.feature" />
    			</antcall>
    			<antcall target="installFeatureFromMarketplace">
    				<param name="marketplace.installUI" value="org.remus.infomngmnt.contacttask.feature" />
    			</antcall>
    	<antcall target="installFeatureFromMarketplace">
    				<param name="marketplace.installUI" value="org.remus.infomngmnt.groovy.feature" />
    			</antcall>
    	<antcall target="installFeatureFromMarketplace">
    				<param name="marketplace.installUI" value="org.remus.infomngmnt.link.feature" />
    			</antcall>
    	<antcall target="installFeatureFromMarketplace">
    				<param name="marketplace.installUI" value="org.remus.infomngmnt.rss.feature" />
    			</antcall>
    	<delete dir="${unzipTarget}/RIM/workspace" failonerror="false"></delete>
    	<zip destfile="${pack.zip}">
    		<zipfileset dir="${unzipTarget}">
    		</zipfileset>
    	</zip>
        
    </target>


	
	<target name="installFeatureFromMarketplace">
    	<java failonerror="true" fork="true" jar="${jar.test.location}">
         	    <arg line=" -application org.eclipse.equinox.p2.director.app.application" />
         	    <arg line=" -nosplash" />
         	    <arg line=" --launcher.suppressErrors" />
         	    <arg line=" -consoleLog" />
         	    <arg line=" -flavor tooling" />
         	    <arg line=" -roaming" />
         	    <arg line=" -profile profile" />
         	    <arg line=" -destination ${p2.director.install.path}" />
         	    <arg line=" -bundlepool ${p2.director.destination}" />
         	    <arg line=" -installIU ${marketplace.installUI}.feature.group" />
         	    <arg line=" -metadataRepository file:${p2.marketplace.input.repo},file:${p2.director.destination}/p2/org.eclipse.equinox.p2.engine/profileRegistry/profile.profile"/>
         	    <arg line=" -artifactRepository file:${p2.marketplace.input.repo},file:${p2.director.destination}" />
         	    <arg line=" -profileProperties org.eclipse.update.install.features=true" />
         	    <arg line=" -vmargs" />
         	    <arg line=" -Declipse.p2.data.area=${p2.director.destination}/p2" />
         	    <arg line=" -Declipse.p2.MD5Check=false" />
         	  </java>
	</target>

	
</project>
